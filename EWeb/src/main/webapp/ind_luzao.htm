﻿<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Highstock Example</title>

		<script type="text/javascript" src="js/jquery_1.8.2/jquery.min.js"></script>
		<style type="text/css">
${demo.css}
		</style>
		<script type="text/javascript">
$(function () {
    var seriesOptions = [],
        seriesCounter = 0,
        date_price = [],
        volume = [],
        data_ma19 = [],
        data_ma43 = [],
        data_ma86 = [];

    /**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
    function createChart() {

        $('#container').highcharts('StockChart', {

                rangeSelector: {
		                selected: 1
		            },
		
		            title: {
		                text: '上证指数'
		            },
		
		            yAxis: [{
		                labels: {
		                    align: 'right',
		                    x: -3
		                },
		                title: {
		                    text: 'Price'
		                },
		                height: '60%',
		                lineWidth: 2
		            }, {
		                labels: {
		                    align: 'right',
		                    x: -3
		                },
		                title: {
		                    text: 'Volume'
		                },
		                top: '65%',
		                height: '35%',
		                offset: 0,
		                lineWidth: 2
		            }],
		
		            series: [{
		                type: 'candlestick',
		                name: '上证指数',
		                data: date_price
		            }, 
		            {
		                name: 'MA19',
		                data: data_ma19
		            }, 
		            {
		                name: 'MA43',
		                data: data_ma43
		            }, 
		            {
		                name: 'MA86',
		                data: data_ma86
		            },                         
		               {
		                type: 'column',
		                name: 'Volume',
		                data: volume,
		                yAxis: 1
		            }]
        });
    }


    $.getJSON('http://localhost:8080/portal/price/002673/2012-01-01_2016-12-31',    function (data) {
        i = 0;
        for (i; i < data.length; i += 1) {
        	var dateStr = data[i]['date'] + " 15:00:00";
            var dateD = new Date(Date.parse(dateStr.replace(/-/g,   "/")));
            date_price.push([
                dateD.getTime(),
                data[i]['open'],
                data[i]['high'],
                data[i]['low'],
                data[i]['close']
            ]);
            
            volume.push([
                dateD.getTime(),
                data[i]['volume']
            ]);  
        }
        
        seriesCounter += 1;
        if (seriesCounter === 2) {
            createChart();
        }
    });
        
    $.getJSON('http://localhost:8080/portal/ind/luzao/002673/2012-01-01_2016-12-31',    function (data) {
        i = 0;
        for (i; i < data.length; i += 1) {
        	var dateStr = data[i]['date'] + " 15:00:00";
            var dateD = new Date(Date.parse(dateStr.replace(/-/g,   "/")));
            data_ma19.push([
                dateD.getTime(),
                data[i]['ma19']
            ]);

            data_ma43.push([
                dateD.getTime(),
                data[i]['ma43']
            ]);
            
            data_ma86.push([
                dateD.getTime(),
                data[i]['ma86']
            ]);
        }
        
        seriesCounter += 1;
        if (seriesCounter === 2) {
            createChart();
        }
    });
});
		</script>
	</head>
	<body>
<script src="js/highstock_4.2.1/highstock.js"></script>
<script src="js/highstock_4.2.1/modules/exporting.js"></script>


<div id="container" style="height: 600px; min-width: 310px"></div>
	</body>
</html>
