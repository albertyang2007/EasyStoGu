﻿<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Highstock Example</title>

		<script type="text/javascript" src="js/jquery_1.8.2/jquery.min.js"></script>
		<style type="text/css">
${demo.css}
		</style>
		<script type="text/javascript">
$(function () {
    var seriesOptions = [],
        seriesCounter = 0,
        date_price = [],
        volume = [],
        data_mb = [],
        data_up = [],
        data_dn = [];

    var stockId = GetQueryString("stockId");
    var dateRange = GetQueryString("date");
            
    function GetQueryString(name)
		{
		    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
		    var r = window.location.search.substr(1).match(reg);
		    if(r!=null)return  unescape(r[2]); return null;
		}    
		
    /**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
    function createChart() {

        $('#container').highcharts('StockChart', {

                rangeSelector: {
		                selected: 1
		            },
		
		            title: {
		                text: 'OHLC'
		            },
		
		            yAxis: [{
		                labels: {
		                    align: 'right',
		                    x: -3
		                },
		                title: {
		                    text: 'Price'
		                },
		                height: '60%',
		                lineWidth: 2
		            }, {
		                labels: {
		                    align: 'right',
		                    x: -3
		                },
		                title: {
		                    text: 'Volume'
		                },
		                top: '65%',
		                height: '35%',
		                offset: 0,
		                lineWidth: 2
		            }],
		
		            series: [{
		                type: 'candlestick',
		                name: 'OHLC',
		                data: date_price
		            }, 
		            {
		                name: 'MB',
		                data: data_mb
		            }, 
		            {
		                name: 'UP',
		                data: data_up
		            }, 
		            {
		                name: 'DN',
		                data: data_dn
		            },                         
		               {
		                type: 'column',
		                name: 'Volume',
		                data: volume,
		                yAxis: 1
		            }]
        });
    }


    var url_price = "http://localhost:8080/portal/price/" + stockId + "/" + dateRange;
    $.getJSON(url_price,    function (data) {
        i = 0;
        for (i; i < data.length; i += 1) {
        	var dateStr = data[i]['date'] + " 15:00:00";
            var dateD = new Date(Date.parse(dateStr.replace(/-/g,   "/")));
            date_price.push([
                dateD.getTime(),
                data[i]['open'],
                data[i]['high'],
                data[i]['low'],
                data[i]['close']
            ]);
            
            volume.push([
                dateD.getTime(),
                data[i]['volume']
            ]);  
        }
        
        seriesCounter += 1;
        if (seriesCounter === 2) {
            createChart();
        }
    });

    var url_boll = "http://localhost:8080/portal/ind/boll/" + stockId + "/" + dateRange;
    $.getJSON(url_boll,    function (data) {
        i = 0;
        for (i; i < data.length; i += 1) {
        	var dateStr = data[i]['date'] + " 15:00:00";
            var dateD = new Date(Date.parse(dateStr.replace(/-/g,   "/")));
            data_mb.push([
                dateD.getTime(),
                data[i]['mb']
            ]);

            data_up.push([
                dateD.getTime(),
                data[i]['up']
            ]);
            
            data_dn.push([
                dateD.getTime(),
                data[i]['dn']
            ]);
        }
        
        seriesCounter += 1;
        if (seriesCounter === 2) {
            createChart();
        }
    });
});
		</script>
	</head>
	<body>
<script src="js/highstock_4.2.1/highstock.js"></script>
<script src="js/highstock_4.2.1/modules/exporting.js"></script>


<div id="container" style="height: 800px; min-width: 310px"></div>
	</body>
</html>
